<!DOCTYPE html>
<html>
	<head>
		<title>noca</title>
		<link rel="icon" type="image/png" href="image.png">
		<link rel="stylesheet" href="global.css">
	</head>

    <body>

        <div class="header">

            <h3>Blog writer</h3>

        </div>

        <div class="main">
            <div class="sidebar-left"></div>
            <div class="content">

                <h2>Editor</h2>
                <div id="editor" contenteditable="true">
                    <p>Type here</p>
                </div> 

                <h2>JSON Output</h2>
                <pre id="jsonOutput"></pre>

            </div>
            <div class="sidebar-right">
                <div id="formattingTools">
                    <button id="headerBtn">Make Header</button>
                    <button id="codeBtn">Make Codeblock</button>
                </div>
            </div>
        </div>

        <script type="module">
            import { makeHeader, makeCodeBlock } from '../scripts/actions.js';
            import { updateJSON } from '../scripts/parser.js';

            document.getElementById('editor').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && e.shiftKey) {
                    e.preventDefault();

                    const sel = window.getSelection();
                    if (!sel.rangeCount) return;

                    const range = sel.getRangeAt(0);
                    range.deleteContents();

                    const br = document.createElement('br');
                    const zwsp = document.createTextNode('\u200B'); // zero-width space

                    const frag = document.createDocumentFragment();
                    frag.appendChild(br);
                    frag.appendChild(zwsp);

                    range.insertNode(frag);
                    range.setStartAfter(zwsp);
                    range.collapse(true);
                    sel.removeAllRanges();
                    sel.addRange(range);
                }
            });


            document.getElementById('headerBtn').addEventListener('click', makeHeader);
            document.getElementById('codeBtn').addEventListener('click', makeCodeBlock);
            document.getElementById('editor').addEventListener('input', updateJSON);
            updateJSON();
        </script>

    </body>
    
</html>